<script>
const user = JSON.parse(localStorage.getItem("user"));
if (!user) {
  alert("⚠️ Please login first!");
  window.location.href = "index.html";
}

// Get buttons
const homeBtn = document.querySelector('.top-nav button:nth-child(1)');
const signOutBtn = document.querySelector('.top-nav button:nth-child(2)');

// Get selected game from localStorage (default to Free Fire)
const selectedGame = localStorage.getItem("selectedGame") || "Free Fire";

// Set body class and button colors dynamically
const body = document.getElementById("voteBody");
if (selectedGame === "Free Fire") {
  body.className = "ff-bg";
  homeBtn.style.background = signOutBtn.style.background = "#ff4d4d"; // FF red
} else if (selectedGame === "BGMI") {
  body.className = "bgmi-bg";
  homeBtn.style.background = signOutBtn.style.background = "#ffb84d"; // BGMI orange
} else if (selectedGame === "Call of Duty") {
  body.className = "cod-bg";
  homeBtn.style.background = signOutBtn.style.background = "#4d79ff"; // COD blue
}

// Hover effect for buttons
[homeBtn, signOutBtn].forEach(btn => {
  btn.addEventListener("mouseover", () => btn.style.opacity = "0.8");
  btn.addEventListener("mouseout", () => btn.style.opacity = "1");
});

// Voting logic
function castVote(playerId) {
  if (localStorage.getItem("hasVotedFF") === "true") {
    const votedPlayer = localStorage.getItem("votedPlayer");
    alert("⚠️ You have already voted for " + votedPlayer + " in " + selectedGame + "!");
    return;
  }
  localStorage.setItem("hasVotedFF", "true");
  localStorage.setItem("votedPlayer", playerId);

  alert("✅ Your vote for " + playerId + " has been submitted!");
  document.querySelectorAll(".ff-btn").forEach(btn => btn.disabled = true);
}

// Home & Sign Out
function goHome() { window.location.href = "index.html"; }
function signOut() {
  if (confirm("Are you sure you want to sign out?")) {
    localStorage.removeItem("user");
    localStorage.removeItem("selectedGame");
    window.location.href = "index.html";
  }
}

// Disable buttons if already voted
window.addEventListener("DOMContentLoaded", () => {
  if (localStorage.getItem("hasVotedFF") === "true") {
    document.querySelectorAll(".ff-btn").forEach(btn => btn.disabled = true);
  }
});
</script>
